# KB-Manager

A command-line interface (CLI) tool for managing files and knowledge bases in OpenWebUI.

## Overview

KB-Manager provides a streamlined way to interact with OpenWebUI's API, allowing you to:
- Create and list knowledge bases
- Upload individual files or entire directories to knowledge bases
- Update and delete files
- List files within specific knowledge bases
- Support for `.kbignore` files for selective uploads

## Features

- **Knowledge Base Management**: Create new knowledge bases and list existing ones
- **File Operations**: Upload, update, delete, and list files
- **Batch Operations**: Upload entire directories with support for ignore patterns
- **Progress Tracking**: Visual progress bars for file uploads
- **Flexible Configuration**: Support for config files, environment variables, and CLI arguments
- **JSON Output**: Optional JSON output for programmatic use
- **Async Operations**: Efficient handling of multiple file uploads

## Installation

### Prerequisites

- Python 3.11 or higher
- An active OpenWebUI instance with API access

### Install from source

```bash
git clone https://github.com/dubh3124/kb-manager.git
cd kb-manager
pip install -e .
```

### Install with development dependencies

```bash
pip install -e ".[dev]"
```

## Getting Started (First-Time Setup)

When you run any `kb-manager` command for the first time, it will automatically launch an interactive setup wizard if the OpenWebUI API client is not found on your system.

```bash
kb-manager list-kbs 
# Output:
# ⚠️  API client not found. This is required for kb-manager to work.
#
# 🚀 KB-Manager Setup Wizard
#
# First, let's configure your OpenWebUI connection.
# Enter your OpenWebUI Base URL [http://localhost:8080]: 
```

**Follow the prompts:**

1.  **OpenWebUI Base URL**: Enter the URL where your OpenWebUI instance is running (e.g., `http://localhost:8080`).
2.  **OpenWebUI API Key**: You will be guided on how to obtain this key from your OpenWebUI instance (Settings -> Account -> API Keys). Enter it when prompted.

Upon successful completion, the wizard will download the necessary OpenAPI specification, install the client generator (if needed), generate the Python API client, and save your API key/URL to `~/.kbmanager/config.yaml`.

Once setup is complete, you can re-run your `kb-manager` command.

## Configuration

KB-Manager can be configured through multiple methods, processed in order of precedence (highest to lowest):

1.  **CLI Arguments** (`--api-key`, `--api-url`)
2.  **Environment Variables** (`KB_MANAGER_API_KEY`, `KB_MANAGER_BASE_URL`)
3.  **Configuration File** (`~/.kbmanager/config.yaml` or `config.yaml` in current directory)

### Configuration File (`~/.kbmanager/config.yaml`)

This file is automatically generated and populated during the first-time setup process. You can also create or edit it manually:

```yaml
# ~/.kbmanager/config.yaml
api_key: your_api_key_here
base_url: http://localhost:8080
```

### Environment Variables

```bash
export KB_MANAGER_API_KEY="your_api_key_here"
export KB_MANAGER_BASE_URL="http://localhost:8080"
```

### CLI Arguments

```bash
kb-manager --api-key "your_api_key_here" --api-url "http://localhost:8080" <command>
```

## Usage

### Global Options

-   `--debug`: Enable verbose debug logging.
-   `--api-key`: Override the API key from config or environment.
-   `--api-url`: Override the base URL from config or environment.

### Main Commands

| Command                     | Description                                            | Example Usage                                                                            |
| :-------------------------- | :----------------------------------------------------- | :--------------------------------------------------------------------------------------- |
| `list-kbs`                  | Lists all knowledge bases.                             | `kb-manager list-kbs` <br> `kb-manager list-kbs --json`                                  |
| `create-kb <name>`          | Creates a new knowledge base.                          | `kb-manager create-kb "My Research Notes" --description "Notes from papers"`             |
| `upload-file <path>`        | Uploads a single file to a KB.                         | `kb-manager upload-file /path/to/document.pdf --kb-id <kb_id>`                           |
| `upload-dir <path>`         | Uploads a directory to a KB.                           | `kb-manager upload-dir /path/to/docs --kb-id <kb_id>`                                    |
| `update-file <file_id>`     | Updates content of an existing file.                   | `kb-manager update-file <file_id> /path/to/new_content.pdf`                              |
| `delete-file <file_id>`     | Deletes a file by its ID.                              | `kb-manager delete-file <file_id>`                                                       |
| `list-files <kb_id>`        | Lists files in a specific KB.                          | `kb-manager list-files <kb_id>` <br> `kb-manager list-files <kb_id> --search "report"`  |
| `delete-all-files <kb_id>` | Deletes ALL files from a specific KB (irreversible). | `kb-manager delete-all-files <kb_id>` <br> `kb-manager delete-all-files <kb_id> --yes` |
| `setup`                     | Manually run the setup wizard for client generation.   | `kb-manager setup`                                                                       |

## .kbignore Files

KB-Manager supports `.kbignore` files, similar to `.gitignore`, for excluding files during `upload-dir` operations.

Place a `.kbignore` file in the root of the directory you are uploading, or specify its path using `--ignore-file`.

Example `.kbignore` content:

```gitignore
# Ignore all log files
*.log

# Ignore temporary files
*.tmp

# Ignore specific directories
__pycache__/
build/

# Negate pattern (include despite other rules)
!important.doc
```

## Development

### Running Tests

```bash
# Install test dependencies
pip install -e ".[test]"

# Run tests
pytest

# Run tests with coverage
pytest --cov=kbmanager --cov-report=xml
```

### Code Quality

```bash
# Install development dependencies
pip install -e ".[dev]"

# Run linter
ruff check .

# Run type checker
mypy kbmanager
```

## Error Handling

KB-Manager provides detailed error messages for common issues:

-   Missing API credentials
-   Network connectivity problems
-   Invalid file paths
-   API validation errors
-   Client generation failures (with warnings for non-critical errors)

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

1.  Fork the repository.
2.  Create your feature branch (`git checkout -b feature/amazing-feature`).
3.  Commit your changes (`git commit -m 'Add amazing feature'`).
4.  Push to the branch (`git push origin feature/amazing-feature`).
5.  Open a Pull Request.

## Acknowledgments

Built for seamless integration with [OpenWebUI](https://github.com/open-webui/open-webui).
